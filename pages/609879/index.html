<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SpringBoot 集成 Validation 参数校验 | Coder 全栈知识体系</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="对自己学习技术知识体系整理，语言面向 Java、JS、Python; 框架涵盖 Spring，Vue；数据库: Redis、MySQL等，运维：Docker、Linux 、K8S等知识体系">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.1066fc64.css" as="style"><link rel="preload" href="/assets/js/app.35af7fd2.js" as="script"><link rel="preload" href="/assets/js/2.bb1dd048.js" as="script"><link rel="preload" href="/assets/js/3.12ef5449.js" as="script"><link rel="preload" href="/assets/js/14.749697d2.js" as="script"><link rel="prefetch" href="/assets/js/10.1d887ea1.js"><link rel="prefetch" href="/assets/js/11.c1cc5db1.js"><link rel="prefetch" href="/assets/js/12.3d12073f.js"><link rel="prefetch" href="/assets/js/13.aacc5341.js"><link rel="prefetch" href="/assets/js/15.20c459ad.js"><link rel="prefetch" href="/assets/js/4.0cb8fbeb.js"><link rel="prefetch" href="/assets/js/5.fa1863b1.js"><link rel="prefetch" href="/assets/js/6.5c2a4487.js"><link rel="prefetch" href="/assets/js/7.2dcc4e0c.js"><link rel="prefetch" href="/assets/js/8.9cbf1e04.js"><link rel="prefetch" href="/assets/js/9.a58464c1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1066fc64.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Coder 全栈知识体系</span></a> <div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><!----> <span class="title" style="display:;">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/91feb9/" class="nav-link">Spring Boot</a></li><li class="dropdown-item"><!----> <a href="/pages/91feb9/" class="nav-link">JPA</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><!----> <span class="title" style="display:;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/609879/404" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/pages/609879/404" class="nav-link">VuePress</a></li></ul></div></div> <!----></nav> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://li-ning1990.oss-cn-shanghai.aliyuncs.com/ErQbZ6_1668932180275.jpg"> <div class="blogger-info"><h3>zeroing</h3> <span>板砖农民工</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><!----> <span class="title" style="display:;">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/91feb9/" class="nav-link">Spring Boot</a></li><li class="dropdown-item"><!----> <a href="/pages/91feb9/" class="nav-link">JPA</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><!----> <span class="title" style="display:;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/609879/404" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/pages/609879/404" class="nav-link">VuePress</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JPA</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>SpringBoot</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/609879/" aria-current="page" class="active sidebar-link">SpringBoot 集成 Validation 参数校验</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/609879/#序言" class="sidebar-link">序言</a></li><li class="sidebar-sub-header level2"><a href="/pages/609879/#spring-boot-中集成-validation" class="sidebar-link">Spring Boot 中集成 validation</a></li><li class="sidebar-sub-header level2"><a href="/pages/609879/#利用-valid-和-validated-注解校验请求参数" class="sidebar-link">利用 @Valid 和 @Validated 注解校验请求参数</a></li><li class="sidebar-sub-header level2"><a href="/pages/609879/#自定义校验方法" class="sidebar-link">自定义校验方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level4"><a href="/pages/609879/#使用-groupss-实现的分组校验" class="sidebar-link">使用 groupss 实现的分组校验</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/609879/#constraintviolationexception-methodargumentnotvalidexception-异常处理" class="sidebar-link">ConstraintViolationException， MethodArgumentNotValidException 异常处理</a></li></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06970110><div class="articleInfo" data-v-06970110><ul class="breadcrumbs" data-v-06970110><li data-v-06970110><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06970110></a></li> <li data-v-06970110><a href="/categories/?category=spring" title="分类" data-v-06970110>spring</a></li><li data-v-06970110><a href="/categories/?category=SpringBoot" title="分类" data-v-06970110>SpringBoot</a></li></ul> <div class="info" data-v-06970110><div title="作者" class="author iconfont icon-touxiang" data-v-06970110><a href="javascript:;" data-v-06970110>zeroing</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06970110><a href="javascript:;" data-v-06970110>2022-11-20</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">SpringBoot 集成 Validation 参数校验<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="springboot-集成-validation-参数校验"><a href="#springboot-集成-validation-参数校验" class="header-anchor">#</a> SpringBoot 集成 Validation 参数校验</h1> <h2 id="序言"><a href="#序言" class="header-anchor">#</a> 序言</h2> <p>前后端接口对接时，一般会对传输的数据的合法性做校验，根据校验负责方为两类：前端或后端。基于SpringBoot良好生态，通过集成 Validation 模块和简单配置，即可实现对参数的校验，本文基于Validation 在 SpringBoot 中的使用，将分为以下部分：</p> <ul><li>1，在 SpringBoot 中 使用 <code>@Validated</code> 和 <code>@Valid</code> 实现对接参数实现校验，其中参数包含请求体、请求体嵌套参数、 <code>PathVariable</code> 及 <code>ParamVariable</code> ；</li> <li>2，针对参数校验失败后抛出的异常 <code>MethodArgumentNotValidException</code>，<code>ConstraintViolationException</code> 等，利用全局异常捕捉处理，重定义HTTP响应码码以及报错信息；</li> <li>3，校验注解中， <code>groups</code>参数用法解析；</li> <li>4，根据 JSR303 规范，自定义校验器，并应用在方法中；</li></ul> <h2 id="spring-boot-中集成-validation"><a href="#spring-boot-中集成-validation" class="header-anchor">#</a> Spring Boot 中集成 validation</h2> <blockquote><p>简述JSR303/JSR-349，hibernate validation，spring validation之间的关系。JSR303是一项标准,JSR-349是其的升级版本，添加了一些新特性，他们规定一些校验规范即校验注解，如@Null，@NotNull，@Pattern，他们位于javax.validation.constraints包下，只提供规范不提供实现。而hibernate validation是对这个规范的实践（不要将hibernate和数据库orm框架联系在一起），他提供了相应的实现，并增加了一些其他校验注解，如@Email，@Length，@Range等等，他们位于org.hibernate.validator.constraints包下。而万能的spring为了给开发者提供便捷，对hibernate validation进行了二次封装，显示校验validated bean时，你可以使用spring validation或者hibernate validation，而spring validation另一个特性，便是其在springmvc模块中添加了自动校验，</p></blockquote> <p><img src="https://images.zeroingpython.top//img/image-20221118232526523.png" alt="image-20221118232526523"></p> <p>根据模块依赖项来讲，spring-boot-starter-validation 依赖于 hibernate-validator， 而 hibernate-validator 又依赖于 validation-api(JSR 303规范)，</p> <p>以 Maven 项目为例，若想集成 validation 功能  可以 在 pom 配置环境中 加入 <code>hibernate-validator</code> 或 <code>spring-boot-starter-validation</code>  依赖项，如下</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-validation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="利用-valid-和-validated-注解校验请求参数"><a href="#利用-valid-和-validated-注解校验请求参数" class="header-anchor">#</a> 利用 <code>@Valid</code> 和 <code>@Validated</code> 注解校验请求参数</h2> <p>SpringBoot 接口参数传入一般有三种方式：</p> <ul><li>2.1，当请求方式为 PUT 或 POST， 通常将参数以JSON 格式传给服务器，Spring接收时会自动将传递来的Json 转化为 Java对象，接口接收时会加上 <code>@RequestBody</code> 注解；</li> <li>2.2，放在接口路径中的参数，用 <code>@PathVaribale</code> 注解修饰 ，形如 <code>/products/{id}</code></li> <li>2.3，Get 请求一般加参方式，放在 param 参数部分，用 <code>@RequestParam</code> 注解修饰 ，形如 <code>@RequestParam(defaultValue = &quot;param&quot;) String param</code></li></ul> <p>在 SpringBoot 中，对以上三种都可以通过注解方式来实现参数校验</p> <p><code>2.1</code> 中请求体中参数校验时，除了参数加上校验注解外，还需要在请求体对象加上 <code>@Valid</code>  或 <code>@Validated</code> 注解，表明该请求体需要经过参数校验</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ValidateReqestDataDto</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Length</span><span class="token punctuation">(</span>min<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>max <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> numStr<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@NotNull</span>
    <span class="token annotation punctuation">@NotBlank</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> nameStr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ValidateRequestBodyController</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 请求体校验，RequestBody，
     * @param validateReqestDataDto
     * @return
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/validate-body&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">validateRequestBody</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Valid</span> <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">ValidateReqestDataDto</span> validateReqestDataDto<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>这里对 接口中的<code>ValidateReqestDataDto</code>  请求体对象加上<code>@Valid</code>   注解，再根据具体需要校验的参数，分别标注上对应限制注解，其中 <code>@Length(min=2,max = 3)</code>表示 参数 <strong>numStr</strong> 的长度必须要在 2 和 3 之间；<code>@NotNull</code>和 <code>@NotBlank</code> 代表参数必传且不能为 空字符；</p> <p>注解<code>@Length</code> 、<code>@NotNull</code> 以及 <code>@NotBlank</code> 为 JSR303 提供的 validation 注解，内部的校验功能hibernate validation 模块都已经帮我们实现好了，我们可以直接拿来使用。</p> <p>官网提供的校验注解大部分内部结构都是相同的，以 <code>@Length</code> 为例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Constraint</span><span class="token punctuation">(</span>
    validatedBy <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">FIELD</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">ANNOTATION_TYPE</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">CONSTRUCTOR</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">PARAMETER</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE_USE</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Repeatable</span><span class="token punctuation">(</span><span class="token class-name">NotBlank<span class="token punctuation">.</span>List</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">NotBlank</span> <span class="token punctuation">{</span>
    <span class="token comment">// 参数校验失败时默认返回的报错信息，也可以自己</span>
    <span class="token class-name">String</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;{javax.validation.constraints.NotBlank.message}&quot;</span><span class="token punctuation">;</span>

    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">groups</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Payload</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">FIELD</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">ANNOTATION_TYPE</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">CONSTRUCTOR</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">PARAMETER</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE_USE</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Documented</span>
    <span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">List</span> <span class="token punctuation">{</span>
        <span class="token class-name">NotBlank</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>校验注解通常包含三部分：</p> <ul><li><p><code>message</code> ：表示参数校验失败返回的报错信息，默认存储在<code>ValidationMessages.properties·</code> ，message 后面的<code>javax.validation.constraints.NotBlank.message</code> 为注解的配置项 key，其中value 即为校验失败返回的错误信息。</p> <p>我们可以对报错信息进行重写，重写方式 在SpringBoot 资源默认配置路径下创建一个 <code>ValidationMessages.properties</code>  文件</p> <p><img src="https://images.zeroingpython.top//img/image-20221118234125514.png" alt="image-20221118234125514"></p> <p>添加一条配置记录，其中 key 为 message 后面携带的 package 路径，value 为 自己要覆盖的报错信息，以 <code>@Length</code> 为例，配置如下：</p></li></ul> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">javax.validation.constraints.NotBlank.message</span> <span class="token punctuation">=</span> <span class="token value attr-value">参数不合法</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><p><code>groups</code> ：用来指定该注解生效的 groups ；对于校验注解有时我们只想在某些条件下生效，可以借助于 groups 参数，默认是全生效；</p></li> <li><p><code>payload</code> 表示&quot;校验问题&quot;的级别，该参数类似于 <code>Log4j</code> 输出日志指定的 <code>DEBUG</code>、<code>INFO</code></p></li></ul> <p>及 <code>WARN</code>等级一样，该参数在日常开发中一般很少用到。</p> <p>当请求体参数校验失败时，Spring会抛出<code>MethodArgumentNotValidException</code>  异常，HTTP响应码为 <code>400</code></p> <p>方式<code>2.2</code> 和 <code>2.3</code> 校验方法跟 方式 <code>2.1</code> 有一些不同，除了在参数标注所需校验注解外，还需要在Controller 类上上标注 <code>@Validated</code>，否则不生效：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@Validated</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ValidateRequestBodyController</span> <span class="token punctuation">{</span>


    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/validate/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">validatePathVariable</span><span class="token punctuation">(</span>
            <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token annotation punctuation">@Max</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    


    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/validateRequestParameter&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">validateRequestParameter</span><span class="token punctuation">(</span>
            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;param&quot;</span><span class="token punctuation">)</span> <span class="token annotation punctuation">@Min</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">int</span> param<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>上述实例中 方法 <code>validatePathVariable</code>  和 <code>validateRequestParameter</code> 分别是对 <code>PathVariable</code>和 <code>RequetParam</code> 参数校验的两种示例；</p> <p>与请求体校验另一处不一样的是，<code>PathVariable</code>和 <code>RequetParam</code> 参数校验失败后，Spring 抛出<code>ConstraintViolationException</code>   ，HTTP 响应码为 500 。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>validation<span class="token punctuation">.</span></span>ConstraintViolationException</span><span class="token operator">:</span> validatePathVariable<span class="token punctuation">.</span>id<span class="token operator">:</span> 最大不能超过<span class="token number">5</span>
 	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>validation<span class="token punctuation">.</span>beanvalidation<span class="token punctuation">.</span></span>MethodValidationInterceptor</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">MethodValidationInterceptor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">120</span><span class="token punctuation">)</span> <span class="token operator">~</span><span class="token punctuation">[</span>spring<span class="token operator">-</span>context<span class="token operator">-</span><span class="token number">5.3</span><span class="token number">.13</span><span class="token punctuation">.</span>jar<span class="token operator">:</span><span class="token number">5.3</span><span class="token number">.13</span><span class="token punctuation">]</span>
 	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>framework<span class="token punctuation">.</span></span>ReflectiveMethodInvocation</span><span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token class-name">ReflectiveMethodInvocation</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">186</span><span class="token punctuation">)</span> <span class="token operator">~</span><span class="token punctuation">[</span>spring<span class="token operator">-</span>aop<span class="token operator">-</span><span class="token number">5.3</span><span class="token number">.13</span><span class="token punctuation">.</span>jar<span class="token operator">:</span><span class="token number">5.3</span><span class="token number">.13</span><span class="token punctuation">]</span>
 	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>framework<span class="token punctuation">.</span></span>CglibAopProxDynamicAdvisedInterceptor</span><span class="token punctuation">.</span><span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">CglibAopProxy</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">698</span><span class="token punctuation">)</span> <span class="token operator">~</span><span class="token punctuation">[</span>spring<span class="token operator">-</span>aop<span class="token operator">-</span><span class="token number">5.3</span><span class="token number">.13</span><span class="token punctuation">.</span>jar<span class="token operator">:</span><span class="token number">5.3</span><span class="token number">.13</span><span class="token punctuation">]</span>
 	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>cn<span class="token punctuation">.</span>zero<span class="token punctuation">.</span>controller<span class="token punctuation">.</span>test<span class="token punctuation">.</span></span>ValidateRequestBodyController</span>$$<span class="token class-name">EnhancerBySpringCGLIB</span>$$<span class="token number">9</span>a0425df<span class="token punctuation">.</span><span class="token function">validatePathVariable</span><span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span>generated<span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">~</span><span class="token punctuation">[</span>classes<span class="token operator">/</span><span class="token operator">:</span>na<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如果我们想将状态码改为4xx(4xx 默认为客户端异常，5xx 为服务端异常)，可以借助全局异常捕捉对异常进行重写，重写方式参考 <code>章节三</code>。</p> <p>目前 hibernate validation 提供的可以直接使用的校验注解如下：</p> <table><thead><tr><th>限制</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td>@Null</td> <td style="text-align:center;">限制只能为null</td></tr> <tr><td>@NotNull</td> <td style="text-align:center;">限制必须不为null</td></tr> <tr><td>@AssertFalse</td> <td style="text-align:center;">限制必须为false</td></tr> <tr><td>@AssertTrue</td> <td style="text-align:center;">限制必须为true</td></tr> <tr><td>@DecimalMax(value)</td> <td style="text-align:center;">限制必须为一个不大于指定值的数字</td></tr> <tr><td>@DecimalMin(value)</td> <td style="text-align:center;">限制必须为一个不小于指定值的数字</td></tr> <tr><td>@Digits(integer,fraction)</td> <td style="text-align:center;">限制必须为一个小数，且整数部分的位数不能超过integer，小数部分的位数不能超过fraction</td></tr> <tr><td>@Future</td> <td style="text-align:center;">限制必须是一个将来的日期</td></tr> <tr><td>@Max(value)</td> <td style="text-align:center;">限制必须为一个不大于指定值的数字</td></tr> <tr><td>@Min(value)</td> <td style="text-align:center;">限制必须为一个不小于指定值的数字</td></tr> <tr><td>@Past</td> <td style="text-align:center;">限制必须是一个过去的日期</td></tr> <tr><td>@Pattern(value)</td> <td style="text-align:center;">限制必须符合指定的正则表达式</td></tr> <tr><td>@Size(max,min)</td> <td style="text-align:center;">限制字符长度必须在min到max之间</td></tr> <tr><td>@NotEmpty</td> <td style="text-align:center;">验证注解的元素值不为null且不为空（字符串长度不为0、集合大小不为0）</td></tr> <tr><td>@NotBlank</td> <td style="text-align:center;">验证注解的元素值不为空（不为null、去除首位空格后长度为0），不同于@NotEmpty，@NotBlank只应用于字符串且在比较时会去除字符串的空格</td></tr> <tr><td>@Email</td> <td style="text-align:center;">验证注解的元素值是Email，也可以通过正则表达式和flag指定自定义的email格式</td></tr></tbody></table> <h2 id="自定义校验方法"><a href="#自定义校验方法" class="header-anchor">#</a> 自定义校验方法</h2> <p>有时官方提供的校验注解不能满足一些验证功能，这里，我们可以自定义验证器应用在程序中。这里我们自定义一个<code>IpAddress</code> 来校验 输入ip 地址是合法，</p> <p>1，首先，定义一个注解 <code>IpAddress</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token constant">FIELD</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Constraint</span><span class="token punctuation">(</span>validatedBy <span class="token operator">=</span> <span class="token class-name">IpAddressValidator</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">IpAddress</span> <span class="token punctuation">{</span>

  <span class="token class-name">String</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;{IpAddress.invalid}&quot;</span><span class="token punctuation">;</span>

  <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">groups</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Payload</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>自定义注解参数 结构 与 <code>hibernate validation</code> 提供的相似，由 <code>message</code>，<code>groups</code> 及 <code>payload</code> 三部分组成
<ul><li>messgae 中的 <code>IpAddress.invalid</code> 需要自定义返回错误信息，定义方式请参考<code>章节2</code></li></ul></li> <li>自定义<code>IpAddress</code>注解的核心部分为 <code>@Constraint(validatedBy = IpAddressValidator.class)</code> 指定注解验证实现类为 <code>IpAddressValidator</code></li></ul> <p>2，创建一个类<code>IpAddressValidator</code>实现 <code>ConstraintValidator</code> 接口，重写 <code>boolean isValid(String var, ConstraintValidatorContext var)</code> 方法，内部定义为自己要实现的参数验证逻辑，返回布尔值，<code>true</code> 为通过，<code>false</code> 表示验证失败，如下:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IpAddressValidator</span> <span class="token keyword">implements</span> <span class="token class-name">ConstraintValidator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IpAddress</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 校验

     * @param constraintValidatorContext
     * @return
     */</span>
      <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isValid</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">,</span> <span class="token class-name">ConstraintValidatorContext</span> constraintValidatorContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Pattern</span> patterns <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">&quot;^([0-9]{1,3})\\.([0-9]{1,3})\\.([0-9]{1,3})\\.([0-9]{1,3})$&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Matcher</span> matcher <span class="token operator">=</span> patterns<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//验证是否正则匹配</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>matcher<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span> group1 <span class="token operator">=</span> matcher<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> split <span class="token operator">=</span> group1<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\\.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">3</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">int</span> octet <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>octet<span class="token operator">&gt;</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token comment">//判断匹配端是否大于255</span>
                        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>要校验的请求体参数：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 请求参数实例
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ValidateReqestDataDto</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Length</span><span class="token punctuation">(</span>min<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>max <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> numStr<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@NotNull</span>
    <span class="token annotation punctuation">@NotBlank</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> nameStr<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@IpAddress</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> ipAddress<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><img src="https://images.zeroingpython.top//img/image-20221119012013214.png" alt="image-20221119012013214"></p> <h4 id="使用-groupss-实现的分组校验"><a href="#使用-groupss-实现的分组校验" class="header-anchor">#</a> 使用 groupss 实现的分组校验</h4> <p>分组检验应用场景：可能多个方法用到同一个实体对象来接收参数，但不用方法中的校验规则可能是不一样的，此时，若在实体对象统一加上约束注解无法解决这个问题，</p> <p>上面的问题，我们可以通过 hiberate validation 的分组校验的方式来解决，借助设定 groups 参数</p> <p>通过例子来说明 groups 是如何使用，假设方法 A、B 方法中都接受 AAA 实体类作为校验参数，其中 AAA 中有个字段 AAC 需要校验，在A 方法中需要 AAC 长度为 2-3，而在方法B中需要 AAC 长度必须大于10，实现方法如下：</p> <ul><li>1，定义实体类<code>ValidateByGroupDto</code> ，并在实体类中加入两个接口 <code>CaseOne</code> 和 <code>CaseTow</code> 来区分不同组</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 定义dto实体类
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ValidateByGroupdDto</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">interface</span>  <span class="token class-name">CaseOne</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span>  <span class="token class-name">CaseTow</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token comment">// 只在 CaseOne 生效;</span>
    <span class="token annotation punctuation">@Length</span><span class="token punctuation">(</span>max <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>min <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>groups <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">CaseOne</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 只在 CaseTwo 生效；</span>
    <span class="token annotation punctuation">@Pattern</span><span class="token punctuation">(</span>regexp <span class="token operator">=</span> <span class="token string">&quot;^(string1|string2|string3)&quot;</span><span class="token punctuation">,</span>message <span class="token operator">=</span><span class="token string">&quot;参数必须为string1或string2或string3&quot;</span> <span class="token punctuation">,</span>groups <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">CaseTow</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> lenStr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>实体类中对 参数 lenStr 加上 连个约束注解<code>@Length</code> 和 <code>@Pattern</code>，并通过设定不同 groups 参数来做区分，其中 <code>@Length</code> 约束注解只在 <strong>CaseOne</strong>  接口类上生效，而 <code>@Pattern</code>  只生效于<strong>CaseTow</strong> 注解</p> <ul><li>2，除了在约束注解上指定 groups 外，若想让分组校验生效，还需要的实体类标注的 <code>@Validated</code>注解也要指定生效的 接口类:</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">/**
     * 验证CaseOne组
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/validate/case-one&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">validateCaseOne</span><span class="token punctuation">(</span>
            <span class="token annotation punctuation">@Validated</span><span class="token punctuation">(</span><span class="token class-name">ValidateByGroupdDto<span class="token punctuation">.</span>CaseOne</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>  <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">ValidateByGroupdDto</span> validateByGroupdDto<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 验证CaseTwo组
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/validate/case-two&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">validateCaseTwo</span><span class="token punctuation">(</span>
            <span class="token annotation punctuation">@Validated</span><span class="token punctuation">(</span><span class="token class-name">ValidateByGroupdDto<span class="token punctuation">.</span>CaseTow</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>  <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">ValidateByGroupdDto</span> validateByGroupdDto<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>上述代码表明 <code>validateCaseOne</code> 只校验 <strong>ValidateByGroupdDto.CaseOne</strong> 接口类，而 <code>validateCaseTwo</code> 则校验</p> <p><strong>ValidateByGroupdDto.CaseTow</strong>  接口类。</p> <p>最终结果如下：</p> <p><img src="https://images.zeroingpython.top//img/image-20221119094008302.png" alt="image-20221119094008302"></p> <h2 id="constraintviolationexception-methodargumentnotvalidexception-异常处理"><a href="#constraintviolationexception-methodargumentnotvalidexception-异常处理" class="header-anchor">#</a> ConstraintViolationException， MethodArgumentNotValidException 异常处理</h2> <p>参数校验失败后，默认<code>ConstraintViolationException， MethodArgumentNotValidException</code> 异常信息会在一些问题：</p> <p>1，返回的报错不明确，干扰信息信息太多，没有准确到某个参数；</p> <p>2，返回的 HTTP 状态码不规范，例如 <code>MethodArgumentNotValidException</code> 返回的HTTP 状态码为 500，按照规范来讲，应该为 4XX 形式</p> <p>以上问题都可以通过全局异常捕捉方式，对异常进行重写，重写返回状态码和错误信息，具体代码如下</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>
<span class="token annotation punctuation">@RestControllerAdvice</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalExceptionHandler</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">logError</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span><span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span><span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;错误接口: {}.请求方法为 {}&quot;</span><span class="token punctuation">,</span>request<span class="token punctuation">.</span><span class="token function">getRequestURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 处理 ConstranintViolationException
     */</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">ConstraintViolationException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseStatus</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">BAD_REQUEST</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultObject</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleConstranitException</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span><span class="token class-name">ConstraintViolationException</span> ex<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">logError</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StringBuilder</span> stringBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">ConstraintViolation</span> violation<span class="token operator">:</span>ex<span class="token punctuation">.</span><span class="token function">getConstraintViolations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// 保存</span>
            <span class="token class-name">String</span> keyPath <span class="token operator">=</span> violation<span class="token punctuation">.</span><span class="token function">getPropertyPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s %s;&quot;</span><span class="token punctuation">,</span>keyPath<span class="token punctuation">,</span>violation<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultObject</span><span class="token punctuation">.</span><span class="token function">failed</span><span class="token punctuation">(</span><span class="token class-name">ResultCode</span><span class="token punctuation">.</span><span class="token constant">BAD_REQUEST</span><span class="token punctuation">,</span>stringBuilder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 处理 MethodArgumenNotValidationException 错误
     */</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">MethodArgumentNotValidException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseStatus</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">BAD_REQUEST</span><span class="token punctuation">)</span><span class="token comment">// 指定返回HTTP状态码</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultObject</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleMethodArgumentNotValidException</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span>
                                                                      <span class="token class-name">MethodArgumentNotValidException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">logError</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StringBuilder</span> stringBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">FieldError</span>  fieldError<span class="token operator">:</span>e<span class="token punctuation">.</span><span class="token function">getBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFieldErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s %s;&quot;</span><span class="token punctuation">,</span>fieldError<span class="token punctuation">.</span><span class="token function">getField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>fieldError<span class="token punctuation">.</span><span class="token function">getDefaultMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultObject</span><span class="token punctuation">.</span><span class="token function">failed</span><span class="token punctuation">(</span><span class="token class-name">ResultCode</span><span class="token punctuation">.</span><span class="token constant">BAD_REQUEST</span><span class="token punctuation">,</span>stringBuilder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><ul><li>以上异常捕捉，进行两方面优化
<ul><li>1，针对 <code>MethodArgumentNotValidException</code> 和 <code>ConstranintViolationException</code> 返回的状态码都统一设置为 400，符合返回接口的规范；</li> <li>2，针对报错信息，找到报错参数以及报错信息，通过组装key-value 形式，再进行返回，但从错误信息就能快速准确找到不合规的参数及原因；</li></ul></li></ul> <p>最终返回效果如下</p> <p><img src="https://images.zeroingpython.top//img/image-20221119005326455.png" alt="image-20221119005326455"></p></div></div>  <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/91feb9/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">ManyToOne、OneToMany级联关系注解用法</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/91feb9/" class="prev">ManyToOne、OneToMany级联关系注解用法</a></span> <!----></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/e3b355/"><div>
            Vue制作一个文档博客
            <!----></div></a> <span class="date">11-20</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/91feb9/"><div>
            ManyToOne、OneToMany级联关系注解用法
            <!----></div></a> <span class="date">11-20</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1347906894@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/Largefreedom" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://li-ning1990.oss-cn-shanghai.aliyuncs.com/fy6n6B_1668932126778.jpg" title="个人微信" target="_blank" class="iconfont icon-weixin"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> <!----></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.35af7fd2.js" defer></script><script src="/assets/js/2.bb1dd048.js" defer></script><script src="/assets/js/3.12ef5449.js" defer></script><script src="/assets/js/14.749697d2.js" defer></script>
  </body>
</html>
