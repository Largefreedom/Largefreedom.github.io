<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ManyToOne、OneToMany级联关系注解用法 | Coder 全栈知识体系</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="对自己学习技术知识体系整理，语言面向 Java、JS、Python; 框架涵盖 Spring，Vue；数据库: Redis、MySQL等，运维：Docker、Linux 、K8S等知识体系">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.1066fc64.css" as="style"><link rel="preload" href="/assets/js/app.35af7fd2.js" as="script"><link rel="preload" href="/assets/js/2.bb1dd048.js" as="script"><link rel="preload" href="/assets/js/3.12ef5449.js" as="script"><link rel="preload" href="/assets/js/13.aacc5341.js" as="script"><link rel="prefetch" href="/assets/js/10.1d887ea1.js"><link rel="prefetch" href="/assets/js/11.c1cc5db1.js"><link rel="prefetch" href="/assets/js/12.3d12073f.js"><link rel="prefetch" href="/assets/js/14.749697d2.js"><link rel="prefetch" href="/assets/js/15.20c459ad.js"><link rel="prefetch" href="/assets/js/4.0cb8fbeb.js"><link rel="prefetch" href="/assets/js/5.fa1863b1.js"><link rel="prefetch" href="/assets/js/6.5c2a4487.js"><link rel="prefetch" href="/assets/js/7.2dcc4e0c.js"><link rel="prefetch" href="/assets/js/8.9cbf1e04.js"><link rel="prefetch" href="/assets/js/9.a58464c1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1066fc64.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Coder 全栈知识体系</span></a> <div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><!----> <span class="title" style="display:;">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/91feb9/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Spring Boot</a></li><li class="dropdown-item"><!----> <a href="/pages/91feb9/" aria-current="page" class="nav-link router-link-exact-active router-link-active">JPA</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><!----> <span class="title" style="display:;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/91feb9/404" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/pages/91feb9/404" class="nav-link">VuePress</a></li></ul></div></div> <!----></nav> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://li-ning1990.oss-cn-shanghai.aliyuncs.com/ErQbZ6_1668932180275.jpg"> <div class="blogger-info"><h3>zeroing</h3> <span>板砖农民工</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><!----> <span class="title" style="display:;">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/91feb9/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Spring Boot</a></li><li class="dropdown-item"><!----> <a href="/pages/91feb9/" aria-current="page" class="nav-link router-link-exact-active router-link-active">JPA</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><!----> <span class="title" style="display:;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/91feb9/404" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/pages/91feb9/404" class="nav-link">VuePress</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JPA</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/91feb9/" aria-current="page" class="active sidebar-link">ManyToOne、OneToMany级联关系注解用法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/91feb9/#jpa-中-joincolumn-与-关联注解之间用法" class="sidebar-link">JPA 中 @JoinColumn 与 关联注解之间用法</a></li><li class="sidebar-sub-header level2"><a href="/pages/91feb9/#orderby-字段排序" class="sidebar-link">@OrderBy 字段排序</a></li><li class="sidebar-sub-header level2"><a href="/pages/91feb9/#org-hibernate-lazyinitializationexception-异常解决方法" class="sidebar-link">org.hibernate.LazyInitializationException 异常解决方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level4"><a href="/pages/91feb9/#方法一-修改配置" class="sidebar-link">方法一，修改配置</a></li><li class="sidebar-sub-header level4"><a href="/pages/91feb9/#方法二-修改关联注解中-fetchtype" class="sidebar-link">方法二，修改关联注解中 FetchType</a></li><li class="sidebar-sub-header level4"><a href="/pages/91feb9/#方法三-利用-hibernate-criteria-api-方法" class="sidebar-link">方法三，利用 Hibernate Criteria API 方法</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06970110><div class="articleInfo" data-v-06970110><ul class="breadcrumbs" data-v-06970110><li data-v-06970110><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06970110></a></li> <li data-v-06970110><a href="/categories/?category=spring" title="分类" data-v-06970110>spring</a></li><li data-v-06970110><a href="/categories/?category=JPA" title="分类" data-v-06970110>JPA</a></li></ul> <div class="info" data-v-06970110><div title="作者" class="author iconfont icon-touxiang" data-v-06970110><a href="javascript:;" data-v-06970110>zeroing</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06970110><a href="javascript:;" data-v-06970110>2022-11-20</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">ManyToOne、OneToMany级联关系注解用法<!----></h1>  <div class="theme-vdoing-content content__default"><p>JPA 做 ORM(Object Relational Mapping，对象关系映射)时，为了开发效率，通常会在实体类上用 hibernate 的关系关联注解。  包括：<code>@OneToOne</code>、 <code>@OneToMany</code> 、<code>@ManyToOne</code> 、<code>@ManyToMany</code> 、<code>@JoinTable</code>、以及 <code>@JoinColumn</code> 以及 <code>OrderBy</code>；</p> <h2 id="jpa-中-joincolumn-与-关联注解之间用法"><a href="#jpa-中-joincolumn-与-关联注解之间用法" class="header-anchor">#</a> JPA 中 <code>@JoinColumn</code> 与 关联注解之间用法</h2> <p><code>@JoinColumn</code> 定义多个字段之间的关联关系，配合<code>@OneToOne</code>、<code>@ManyToOne</code> 以及 <code>@OneToMany</code>一起使用</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Repeatable</span><span class="token punctuation">(</span><span class="token class-name">JoinColumns</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">FIELD</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">JoinColumn</span> <span class="token punctuation">{</span>
	<span class="token comment">// 关联字段(子)</span>
    <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
	<span class="token comment">// 关键实体字段(父）)，非必填</span>
    <span class="token class-name">String</span> <span class="token function">referencedColumnName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">unique</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">nullable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">// 是否更新 插入操作</span>
    <span class="token keyword">boolean</span> <span class="token function">insertable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">updatable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> <span class="token function">columnDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

    <span class="token class-name">ForeignKey</span> <span class="token function">foreignKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token annotation punctuation">@ForeignKey</span><span class="token punctuation">(</span><span class="token class-name">ConstraintMode</span><span class="token punctuation">.</span><span class="token constant">PROVIDER_DEFAULT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>以 <code>@OneToMany</code> 注解为例，源代码如下</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">FIELD</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">OneToMany</span> <span class="token punctuation">{</span>
    <span class="token comment">// 关联对象实体类</span>
    <span class="token class-name">Class</span> <span class="token function">targetEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token keyword">void</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
	
    <span class="token comment">// 级联类型，</span>
    <span class="token comment">// ALL, 级联所有操作</span>
    <span class="token comment">// PERSIST,级联持久化</span>
    <span class="token comment">// MERGE, 级联更新合并</span>
    <span class="token comment">// REMOVE,级联删除</span>
    <span class="token comment">// REFRESH,  刷新后更新</span>
    <span class="token comment">//DETACH;  级联脱管操作</span>
    <span class="token class-name">CascadeType</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">cascade</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	
    <span class="token comment">//  获取方式</span>
    <span class="token comment">// LAZY 懒加载，需要时加载;</span>
    <span class="token comment">// EARLY 提前加载</span>
    <span class="token class-name">FetchType</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span><span class="token constant">LAZY</span><span class="token punctuation">;</span>
	<span class="token comment">// 被映射实体类名，当关联实体类上注有 ManyToOne 时，该参数必填；</span>
    <span class="token class-name">String</span> <span class="token function">mappedBy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> <span class="token function">orphanRemoval</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><code>@OneToMany</code> 使用时可以结合 <code>@JoinColumn</code> 一起使用，既可以单向，也可以双向关联；单向指的是只配置一方，双向指两方都配置，实例如下：</p> <p>假设小组（<code>GroupClass</code>）与学生（<code>Student</code>）关系，一个组可以容纳多个学生，一对多 ；多个学生组件成一个组（多对一）；</p> <p>外键关联，一般子实体类这边维护，因此由<code>Student</code> 来关联 ：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;student&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token punctuation">{</span>
    
    <span class="token comment">// 主键自动生成策略</span>
    <span class="token annotation punctuation">@Id</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;student_no&quot;</span><span class="token punctuation">,</span>unique <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> studentNo<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;group_class_id&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> groupClassId<span class="token punctuation">;</span>
	
 	<span class="token comment">// 关联关系多对一，级联关系，可更新，持久化， 获取方式懒加载；</span>
    <span class="token annotation punctuation">@ManyToOne</span><span class="token punctuation">(</span>targetEntity <span class="token operator">=</span> <span class="token class-name">GroupClass</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
            cascade <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">CascadeType</span><span class="token punctuation">.</span><span class="token constant">MERGE</span><span class="token punctuation">,</span><span class="token class-name">CascadeType</span><span class="token punctuation">.</span><span class="token constant">PERSIST</span><span class="token punctuation">,</span><span class="token class-name">CascadeType</span><span class="token punctuation">.</span><span class="token constant">REFRESH</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span><span class="token constant">LAZY</span><span class="token punctuation">)</span>
      <span class="token comment">// 以 group_id 为外键进行关联，referencedColumnName 默认为被关联实体类主键，可以忽略；</span>
    <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;group_class_id&quot;</span><span class="token punctuation">,</span>referencedColumnName <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">GroupClass</span> groupClass<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>而双向关联的 <code>GroupClass</code> 实体类(父类)，定义如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;group_class&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GroupClass</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;group_no&quot;</span><span class="token punctuation">,</span>unique <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> groupNo<span class="token punctuation">;</span>

	<span class="token comment">// 由于外键关联由 Student 维护，这里不需要在做处理，只需要引用 </span>
    <span class="token comment">// @OneToMany中的 mappedBy 参数即可；</span>
    <span class="token annotation punctuation">@OneToMany</span><span class="token punctuation">(</span>mappedBy <span class="token operator">=</span> <span class="token string">&quot;groupClass&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> students <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>其它关联注解用法类同：</p> <ul><li><code>@ManyToMany</code> ：多对多；</li> <li><code>@OneToOne</code> ：一对一；</li></ul> <h2 id="orderby-字段排序"><a href="#orderby-字段排序" class="header-anchor">#</a> <code>@OrderBy</code> 字段排序</h2> <p><code>@OrderBy</code> 顾名思义目的是为根据某个字段进行排序，注解一般与 <code>@OneToMany</code> 和 <code>@ManyToMany</code> 同时使用，</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@OneToMany</span><span class="token punctuation">(</span>mappedBy <span class="token operator">=</span> <span class="token string">&quot;groupClass&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// 根据名字对 学生对象逆向排序 </span>
<span class="token annotation punctuation">@OrderBy</span><span class="token punctuation">(</span><span class="token string">&quot;name DESC&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> students <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>使用实例如下，首先插入1条 <code>GroupClass</code> 和 两条<code>Student</code> 记录，并将两个 <code>Student</code> 关联至 <code>GroupClass</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>  <span class="token comment">// 持久化 GroupClass</span>
  <span class="token class-name">GroupClass</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GroupClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  group<span class="token punctuation">.</span><span class="token function">setGroupNo</span><span class="token punctuation">(</span><span class="token string">&quot;Ano&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  group<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;名字&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  group<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//持久化 Student;</span>
  <span class="token class-name">Student</span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  student<span class="token punctuation">.</span><span class="token function">setStudentNo</span><span class="token punctuation">(</span><span class="token string">&quot;12&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  student<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  student<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;name1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  student<span class="token punctuation">.</span><span class="token function">setGroupClass</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Student</span> student2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  student2<span class="token punctuation">.</span><span class="token function">setStudentNo</span><span class="token punctuation">(</span><span class="token string">&quot;122&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  student2<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  student2<span class="token punctuation">.</span><span class="token function">setGroupClass</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span>
  student2<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;name12&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// save 保存</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> students <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  students<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>
  students<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>student2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  group<span class="token punctuation">.</span><span class="token function">setStudents</span><span class="token punctuation">(</span>students<span class="token punctuation">)</span><span class="token punctuation">;</span>
  groupClassRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>根据<code>Id</code> 查询 GroupClass 对象，在输出打印对象的<code>toString</code> 方法钱，需要重新写一下 对象的 <code>toString</code> 函数，防止循环嵌套导致的堆栈溢出问题</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>   <span class="token comment">//Student.class </span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Student [id=&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&quot;, name=&quot;</span> <span class="token operator">+</span>name <span class="token operator">+</span> <span class="token string">&quot;, studentNo=&quot;</span> <span class="token operator">+</span>studentNo <span class="token operator">+</span> <span class="token string">&quot;, groupClassId=&quot;</span> <span class="token operator">+</span> groupClassId
                <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>在上面例子中， <code>GroupClass</code> 对象中 <code>toString</code> 函数引用到 <code>Student</code>，而 <code>Student</code> 的 <code>toString</code> 同时引用到 <code>GroupClass</code>，使用时会触发嵌套循环，造成栈溢出问题；</p> <p><img src="https://images.zeroingpython.top//img/image-20221115090622405.png" alt="image-20221115090622405"></p> <p>输出 <code>groupClass.toString</code>后，就会发现 <code>groupClass</code> 关联的 students 属性是按照  <code>@OrderBy</code> 注解输出，如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GroupClass</span><span class="token punctuation">&gt;</span></span> groupClassOptional <span class="token operator">=</span> groupClassRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span>groupClassOptional<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token class-name">GroupClass</span> groupClass <span class="token operator">=</span> groupClassOptional<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;groupClass str is {}&quot;</span><span class="token punctuation">,</span>groupClass<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>日志输出如下：</p> <blockquote><p>groupClass str is GroupClass(id=2, name=名字, groupNo=Ano, students=[Student [id=2, name=cname, studentNo=122, groupClassId=2], Student [id=1, name=bname1, studentNo=12, groupClassId=2]])</p></blockquote> <p>重写实体类 <code>toString</code>  方法，可以解决了父子实体类打印输出时，因相互依赖循环嵌套中堆栈溢出问题；但当实体类通过 SpringBoot 中 <code>@ResponseBody</code>以 Json 格式输出给前端时，会出现序列化堆栈溢出问题</p> <blockquote><p>Could not write JSON: Infinite recursion (StackOverflowError); nested exception is com.fasterxml.jackson.databind.JsonMappingException: Infinite recursion (StackOverflowError)</p></blockquote> <p>该错误解决方法：在父类或子类对应的关联字段上，加上 <code>JsonIgnore</code> 注解，即在 Json序列化 时忽略该属性</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Json 序列化时忽略该属性</span>
<span class="token annotation punctuation">@JsonIgnore</span>
<span class="token annotation punctuation">@ManyToOne</span><span class="token punctuation">(</span>targetEntity <span class="token operator">=</span> <span class="token class-name">GroupClass</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
           cascade <span class="token operator">=</span> <span class="token class-name">CascadeType</span><span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">,</span>
           fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span><span class="token constant">LAZY</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;group_class_id&quot;</span><span class="token punctuation">,</span>referencedColumnName <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> insertable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> updatable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">GroupClass</span> groupClass<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>另一方面，我们在项目配置中打开JPA日志输出调试设置</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">srping</span><span class="token punctuation">:</span>
  <span class="token key atrule">jpa</span><span class="token punctuation">:</span>
    <span class="token key atrule">show-sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

    <span class="token key atrule">hibernate</span><span class="token punctuation">:</span>
      <span class="token key atrule">ddl-auto</span><span class="token punctuation">:</span> none

    <span class="token key atrule">properties</span><span class="token punctuation">:</span>
      <span class="token comment"># 将 hibernate 执行语句以 sql 形式打印</span>
      <span class="token key atrule">hibernate.format_sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">hibernate.id.new_generator_mappings</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>因此可以从控制台日志输出来查看内部执行的sql逻辑</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>  <span class="token keyword">select</span>
        groupclass0_<span class="token punctuation">.</span>id <span class="token keyword">as</span> id1_5_0_<span class="token punctuation">,</span>
        groupclass0_<span class="token punctuation">.</span>group_no <span class="token keyword">as</span> group_no2_5_0_<span class="token punctuation">,</span>
        groupclass0_<span class="token punctuation">.</span>name <span class="token keyword">as</span> name3_5_0_<span class="token punctuation">,</span>
        students1_<span class="token punctuation">.</span>group_class_id <span class="token keyword">as</span> group_cl2_6_1_<span class="token punctuation">,</span>
        students1_<span class="token punctuation">.</span>id <span class="token keyword">as</span> id1_6_1_<span class="token punctuation">,</span>
        students1_<span class="token punctuation">.</span>id <span class="token keyword">as</span> id1_6_2_<span class="token punctuation">,</span>
        students1_<span class="token punctuation">.</span>group_class_id <span class="token keyword">as</span> group_cl2_6_2_<span class="token punctuation">,</span>
        students1_<span class="token punctuation">.</span>name <span class="token keyword">as</span> name3_6_2_<span class="token punctuation">,</span>
        students1_<span class="token punctuation">.</span>student_no <span class="token keyword">as</span> student_4_6_2_ 
    <span class="token keyword">from</span>
        group_class groupclass0_ 
    <span class="token keyword">left</span> <span class="token keyword">outer</span> <span class="token keyword">join</span>
        student students1_ 
            <span class="token keyword">on</span> groupclass0_<span class="token punctuation">.</span>id<span class="token operator">=</span>students1_<span class="token punctuation">.</span>group_class_id 
    <span class="token keyword">where</span>
        groupclass0_<span class="token punctuation">.</span>id<span class="token operator">=</span>? 
    <span class="token keyword">order</span> <span class="token keyword">by</span>
        students1_<span class="token punctuation">.</span>name <span class="token keyword">desc</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="org-hibernate-lazyinitializationexception-异常解决方法"><a href="#org-hibernate-lazyinitializationexception-异常解决方法" class="header-anchor">#</a> org.hibernate.LazyInitializationException 异常解决方法</h2> <p>在JPA 中使用关系注解例如<code>@ManyToOne</code> 、 <code>@OneToMany</code> ，其中<code>fetchType</code>参数默认为 <code>LAZY</code> 对象懒加载 ；当关联实体类在数据库没有记录存在时，会报出<code>LazyInitializationException</code> 错误：</p> <blockquote><p>org.hibernate.LazyInitializationException: failed to lazily initialize a collection of role: com.cn.entity.test.GroupClass.students, could not initialize proxy - no Session</p></blockquote> <p>错误出现原因 ，简单来说就是，以延迟方式加载对象时，此时 Hibernate 与数据库通信时 <code>session</code> 已经管理了，没有相关 <code>session</code> 可以通信了。</p> <p>深入理解错误之前，需要了解 <code>session</code>， <code>Lazy initialisation</code> 以及 <code>Proxy Object</code> 等基本概念，以及在 Hibernate 框架中它们是怎么一起运作的</p> <ul><li>1，session 代表一个持久化 上下文，对应用和数据库之间代表一种通信交流，类似于客户端与服务器之间的通信 session  (会话)</li> <li>2，懒加载意味对象不会直接从 session context 加载，触发条件是从代码层获取的时候才会加载。</li> <li>3，Hibernate 创建一个 动态 <code>Proxy Object</code> 类作为代理来访问数据库，并且仅当我们首次使用对象时，它才访问数据库；</li></ul> <p><code>LazyInitializationException</code> 错误发生是当我们尝试借助代理对象从数据库中获取一个懒加载对象，但 <code>Hibernate session</code> 此时已经关闭，从而报错</p> <p>该错误解决方法：</p> <h4 id="方法一-修改配置"><a href="#方法一-修改配置" class="header-anchor">#</a> 方法一，修改配置</h4> <p>在配置文件 <code>yml</code> 或 <code>properties</code> 中将 <code>hibernate.enable_lazy_load_no_trans</code> 参数设为 true，该参数 用于声懒加载对象的的获取全局方式，默认为 <code>false</code> ，打开它意味着当每次以懒加载方式获取关联实体对象时，都将运行在新的事务中的新会话中。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code> <span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">jpa</span><span class="token punctuation">:</span>
    <span class="token comment"># 控制台打印 sql</span>
    <span class="token key atrule">show-sql</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">hibernate</span><span class="token punctuation">:</span>
      <span class="token key atrule">ddl-auto</span><span class="token punctuation">:</span> none
    <span class="token key atrule">properties</span><span class="token punctuation">:</span>
      <span class="token comment"># 解决 LazyInitializationException 错误</span>
      <span class="token key atrule">hibernate.enable_lazy_load_no_trans</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>方法存在一定的弊端：会导致 <code>N+1</code> 问题，Hibernate 首先执行一个 <code>Select</code> 来获取 目标实体类，然后根据实体类关联的属性，再执行 <code>N</code>(<code>N</code> 代表关联属性的个数 ) 个 <code>Select</code> 操作查询实体类的相关属性；</p> <h4 id="方法二-修改关联注解中-fetchtype"><a href="#方法二-修改关联注解中-fetchtype" class="header-anchor">#</a> 方法二，修改关联注解中 FetchType</h4> <p>将 <code>FetchType.LAZY</code> 更改为 <code>FetchType.EARLY</code> ，当我们需要用到关联类的大多数级联属性时，这算一种较为常规的修改方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@OneToMany</span><span class="token punctuation">(</span>mappedBy <span class="token operator">=</span> <span class="token string">&quot;groupClass&quot;</span><span class="token punctuation">,</span>cascade <span class="token operator">=</span> <span class="token class-name">CascadeType</span><span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">,</span>fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span><span class="token constant">EAGER</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@OrderBy</span><span class="token punctuation">(</span><span class="token string">&quot;name DESC&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> students <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="方法三-利用-hibernate-criteria-api-方法"><a href="#方法三-利用-hibernate-criteria-api-方法" class="header-anchor">#</a> 方法三，利用 Hibernate Criteria API 方法</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Criteria</span> criteria <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span><span class="token class-name">GroupClass</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">setFetchMode</span><span class="token punctuation">(</span><span class="token string">&quot;students&quot;</span><span class="token punctuation">,</span> <span class="token class-name">FetchMode</span><span class="token punctuation">.</span><span class="token constant">EAGER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>对比以上方法，该方法是最高效的，查询时通过一条 SQL 语句实现从数据库中获取目标实体关联集合，解决<code>N+1</code>Select 查询效率问题</p></div></div>  <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><!----> <a href="/pages/609879/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">SpringBoot 集成 Validation 参数校验</div></a></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/pages/609879/">SpringBoot 集成 Validation 参数校验</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/e3b355/"><div>
            Vue制作一个文档博客
            <!----></div></a> <span class="date">11-20</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/609879/"><div>
            SpringBoot 集成 Validation 参数校验
            <!----></div></a> <span class="date">11-20</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1347906894@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/Largefreedom" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://li-ning1990.oss-cn-shanghai.aliyuncs.com/fy6n6B_1668932126778.jpg" title="个人微信" target="_blank" class="iconfont icon-weixin"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> <!----></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.35af7fd2.js" defer></script><script src="/assets/js/2.bb1dd048.js" defer></script><script src="/assets/js/3.12ef5449.js" defer></script><script src="/assets/js/13.aacc5341.js" defer></script>
  </body>
</html>
